name: CI Testing
on:
  push:
    branches:
      - main
  pull_request:
    types: [opened, synchronize, reopened]
jobs:
  lint-pw-lesson-30: 
    name: 'Lint PW folder lesson 30'
    runs-on: ubuntu-latest
    container:
     image: node:22-slim
    steps:
      - uses: actions/checkout@v5
      - name: Install dependencies
        working-directory: ./lesson-30
        run: npm ci
      - name: Run lint
        working-directory: ./lesson-30
        run: npm run lint
  tests-pw-default-image: 
    name: 'PW e2e tests on default image'
    needs: lint-pw-lesson-30
    runs-on: ubuntu-latest
    container:
     image: mcr.microsoft.com/playwright:v1.54.0
    permissions:
      contents: read
      checks: write
    steps:
      - uses: actions/checkout@v5
      - name: Install dependencies
        working-directory: ./lesson-26
        run: npm ci
      - name: Run e2e tests
        working-directory: ./lesson-26
        run: |
              npm run pw:test:chromium
      - uses: actions/upload-artifact@v4
        if: ${{ !cancelled() }}
        with:
          name: playwright-report-default
          path: |
                lesson-26/playwright-report/
                lesson-26/test-results/
                lesson-26/results.xml
          retention-days: 30
      - name: Publish Test Report
        uses: mikepenz/action-junit-report@v5
        if: success() || failure() # always run even if the previous step fails
        with:
          report_paths: 'lesson-26/results.xml'
          token: ${{ secrets.GITHUB_TOKEN }}